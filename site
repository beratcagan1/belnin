<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Belbin Deep Guessing Game</title>
  <style>
    :root{
      --bg:#f8fafc; --panel:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e2e8f0;
      --accent:#111827; --good:#059669; --warn:#b45309; --bad:#b91c1c; --chip:#f1f5f9;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(#fff,#f8fafc);color:var(--ink)}
    .wrap{max-width:940px;margin:auto;padding:24px}
    h1{font-size:clamp(22px,3.5vw,30px);margin:0 0 4px}
    p.sub{margin:0;color:var(--muted);font-size:14px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;border:1px solid var(--line);background:#f8fafc;font-size:12px;color:#334155}
    .badge.solid{background:var(--accent);color:#fff;border-color:var(--accent)}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 2px 6px rgba(15,23,42,.04)}
    .card h2{font-size:18px;margin:0}
    .card-head{padding:16px 18px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;gap:16px}
    .card-body{padding:18px}
    .muted{color:var(--muted)}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;border:1px solid var(--line);background:#fff;color:#111827;padding:10px 14px;border-radius:10px;cursor:pointer}
    button:hover{background:#f8fafc}
    button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    button:disabled{opacity:.5;cursor:not-allowed}
    .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:10px}
    .opt{display:flex;gap:10px;border:1px solid var(--line);border-radius:10px;padding:10px;align-items:flex-start;background:#fff}
    .opt input{margin-top:3px}
    .kicker{font-size:12px;color:var(--muted)}
    .progress{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:#111827;width:0}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{background:var(--chip);border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px;color:#334155}
    .alert{border:1px solid var(--line);background:#f8fafc;border-radius:10px;padding:10px;color:#334155}
    .result{border:1px solid var(--line);border-radius:10px;padding:12px;background:#fff}
    .good{background:#ecfdf5;border-color:#a7f3d0}
    .warn{background:#fffbeb;border-color:#fde68a}
    .bad{background:#fef2f2;border-color:#fecaca}
    details{padding:12px}
    details+details{border-top:1px solid var(--line)}
    summary{cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .cluster-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .cluster-box{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff}
    .small{font-size:12px;color:var(--muted)}
    blockquote{margin:0;padding:10px 12px;border-left:4px solid #cbd5e1;background:#f8fafc;border-radius:8px}
    .footer{font-size:12px;color:var(--muted);text-align:center;margin-top:16px}
    @media (max-width:520px){.opt{flex-direction:row}}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="row" style="justify-content:space-between">
      <div>
        <h1>Belbin Deep Guessing Game</h1>
        <p class="sub">Layered scenarios ‚Ä¢ immediate feedback ‚Ä¢ reasoning & cluster analysis</p>
      </div>
      <div class="row">
        <span class="badge" id="qCount">Questions: 0</span>
        <span class="badge solid" id="scoreBadge">Score: 0.0</span>
      </div>
    </header>

    <section style="margin:14px 0">
      <div class="row" style="justify-content:space-between;margin-bottom:6px">
        <span class="small">Progress</span>
        <span class="small" id="progressText">0/0</span>
      </div>
      <div class="progress"><div class="bar" id="progressBar"></div></div>
    </section>

    <div class="card" id="questionCard">
      <div class="card-head">
        <div>
          <h2 id="scenarioTitle">Scenario 1</h2>
          <div class="kicker">Consider multiple dimensions (context, trade‚Äëoffs, team impact)</div>
        </div>
        <div class="row">
          <span class="badge" id="clusterBadge">Cluster</span>
          <button id="hintBtn" title="Toggle hint">üí° Hint</button>
        </div>
      </div>
      <div class="card-body">
        <blockquote id="scenarioText"></blockquote>
        <div id="hintBox" class="alert" style="display:none"></div>

        <div class="options" id="options"></div>

        <div class="controls" style="margin-top:12px">
          <button class="primary" id="submitBtn">‚úì Submit guess</button>
          <button id="prevBtn">‚Üê Prev</button>
          <button id="nextBtn">Next ‚Üí</button>
          <button id="resetBtn">‚ü≤ Reset</button>
        </div>

        <div id="feedback"></div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="card-head">
        <div>
          <h2>Results & Reasoning</h2>
          <div class="kicker">Review performance by cluster and expand to see rationale per question</div>
        </div>
        <button id="toggleAll">Show all explanations</button>
      </div>
      <div class="card-body">
        <div class="cluster-grid" id="clusterGrid"></div>
        <div id="review"></div>
        <div id="finalBox" style="display:none;margin-top:12px" class="result">
          <div class="small">Final score</div>
          <div style="font-size:24px;font-weight:700"><span id="finalScore">0.0</span> <span class="muted">/ <span id="finalTotal">0</span></span></div>
          <p class="small">Full credit for exact matches; half credit for near‚Äëmiss roles with overlapping behaviours.</p>
        </div>
      </div>
    </div>

    <div class="footer">Tip: Each role lives in tension with others. Look for the <b>trade‚Äëoff</b> being paid to create value.</div>
  </div>

<script>
// -------- Data --------
const ROLES = {
  PL: { name: "Plant", cluster: "Thought", blurb: "Original, imaginative ideas; may overlook practicalities." },
  RI: { name: "Resource Investigator", cluster: "People", blurb: "Explores opportunities and contacts; may lose interest later." },
  CO: { name: "Coordinator", cluster: "People", blurb: "Clarifies goals, delegates well; can seem over-directive." },
  SH: { name: "Shaper", cluster: "Action", blurb: "Drives momentum under pressure; may be provocative or impatient." },
  ME: { name: "Monitor Evaluator", cluster: "Thought", blurb: "Sober, strategic judgement; can appear critical or detached." },
  TW: { name: "Teamworker", cluster: "People", blurb: "Supports, listens, and harmonises; may avoid decisive stands." },
  IMP:{ name: "Implementer", cluster: "Action", blurb: "Turns ideas into plans and systems; can be inflexible to late change." },
  CF: { name: "Completer Finisher", cluster: "Action", blurb: "Polishes and perfects; may worry over details and pace." },
  SP: { name: "Specialist", cluster: "Thought", blurb: "Provides rare expertise; narrow focus outside their niche." },
};
const ROLE_ORDER = ["PL","RI","CO","SH","ME","TW","IMP","CF","SP"];

const SCENARIOS = [
  { id:"S1", text:"In the early stages of brainstorming, Devon is restless. They press the group to stop circling and commit to one direction. Their urgency creates momentum, but some teammates feel bulldozed. When questioned, Devon insists that progress is better than perfection.", role:"SH", alt:["CO","IMP"], reasons:["Pushes for pace and direction under ambiguity (classic Shaper driver).","Willingness to provoke and risk ruffling feathers to avoid drift.","Focus on momentum over polish is an action-bias hallmark."], dims:["time pressure","conflict tolerance","momentum vs perfection"], hint:"Notice the intolerance for dithering and appetite for friction." },
  { id:"S2", text:"Morgan rarely dominates meetings but has a talent for distilling sprawling conversations into a clear set of options. They don‚Äôt push a personal agenda, yet people look to them to frame decisions. Occasionally they‚Äôre accused of being too hands-off, quietly steering rather than jumping in.", role:"CO", alt:["ME","TW"], reasons:["Clarifies goals and frames choices without hijacking content (Coordinator).","Delegative, agenda-light posture with social authority.","Perception of ‚Äòsteering‚Äô speaks to orchestration rather than analysis alone."], dims:["sense-making","delegation","authority without dominance"], hint:"Who synthesises and allocates rather than invents or critiques?" },
  { id:"S3", text:"Jordan loves the thrill of kick-off phases. Within days they‚Äôve made useful contacts, gathered fresh intel, and spotted possibilities others missed. Midway through, their attention drifts‚Äîthey‚Äôre scanning the horizon for the next spark. Teammates enjoy the energy but grumble about follow‚Äëthrough.", role:"RI", alt:["PL"], reasons:["External scanning and networking yield quick opportunities (Resource Investigator).","High early energy with novelty-seeking, lower stamina for closure.","Value-add is connections and options, not finishing or systemising."], dims:["exploration","novelty","follow-through gap"], hint:"Think ‚Äòoutside links‚Äô more than ‚Äòinside polish‚Äô." },
  { id:"S4", text:"Amira is valued for her thoroughness. She notices inconsistencies nobody else sees and insists they be corrected before submission. The team knows the quality will be high, but some complain she slows them with details that don‚Äôt feel mission‚Äëcritical. Amira says the details protect credibility.", role:"CF", alt:["IMP"], reasons:["Meticulous error‚Äëspotting and insistence on standards (Completer Finisher).","Quality assurance ethos even under deadline pressure.","Tension between speed and precision is central to CF."], dims:["quality bar","risk aversion","detail orientation"], hint:"Who loses sleep over the last 5%?" },
  { id:"S5", text:"Chris introduces bold, sometimes eccentric ideas that leave colleagues intrigued but occasionally exasperated. Many proposals are discarded; a few reshape the direction entirely. Chris tends to lose interest once others take over the practicalities.", role:"PL", alt:["RI","SP"], reasons:["Original ideation with variable practicality (Plant).","Disengages from routine execution once the spark is provided.","Disruptive creativity shifts trajectories when it lands."], dims:["originality","divergent thinking","hands-off execution"], hint:"The value is the spark, not the scaffolding." },
  { id:"S6", text:"Casey listens quietly and, when asked, points out risks and weak assumptions others missed. They rarely speak first, but when they do, the group reconsiders. Some see Casey as too cool or negative, but their calls are usually right.", role:"ME", alt:["CO"], reasons:["Analytical, dispassionate evaluation and ‚Äòcold‚Äô judgement (Monitor Evaluator).","Contributes late with high-signal critique rather than energy or harmony.","Valued for accuracy over enthusiasm."], dims:["critical thinking","risk spotting","low affect"], hint:"Less spark, more signal-to-noise." },
  { id:"S7", text:"Alex steps in when tension rises, noticing who‚Äôs quiet and drawing them in. Meetings feel safer and more inclusive, though decisions sometimes slow as compromises are brokered. Morale stays intact even through setbacks.", role:"TW", alt:["CO"], reasons:["Attends to cohesion, inclusion, and morale (Teamworker).","Trades speed for psychological safety and participation.","Stabilises relationships during ambiguity or stress."], dims:["harmony","inclusion","pace vs safety"], hint:"Whose instinct is ‚Äòmake the room work‚Äô rather than ‚Äòmake the plan work‚Äô?" },
  { id:"S8", text:"Priya takes a freewheeling brainstorm and turns it into a sequenced plan with checklists and simple operating routines. She‚Äôs reliable and steady day to day, but resists late changes that threaten the structure. Others appreciate the predictability yet sometimes chafe at the rigidity.", role:"IMP", alt:["CO","CF"], reasons:["Translates ideas into implementable systems (Implementer).","Reliability and order over improvisation; sceptical of last‚Äëminute pivots.","Creates scaffolding the team can actually use."], dims:["systematisation","reliability","change‚Äëresistance"], hint:"From concept to checklists‚Äîwho owns that bridge?" },
  { id:"S9", text:"Lee holds deep expertise in a narrow technical field. In crunch moments their insight unlocks progress, but outside that niche they‚Äôre quiet and don‚Äôt engage much. Some call this single‚Äëminded; others call it indispensable.", role:"SP", alt:["ME"], reasons:["Depth over breadth‚Äîrare domain knowledge (Specialist).","High value at specific bottlenecks; limited contributions elsewhere.","Identity tied to expertise rather than coordination or drive."], dims:["expertise","bottleneck solving","narrow focus"], hint:"Whose value spikes exactly when the problem enters their lane?" },
];

// -------- State --------
let order = shuffle([...SCENARIOS]);
let index = 0;
let answers = {}; // id -> {pick, score, state}
let choice = null;
let revealAll = false;

// -------- Elements --------
const qCount = document.getElementById('qCount');
const scoreBadge = document.getElementById('scoreBadge');
const progressText = document.getElementById('progressText');
const progressBar = document.getElementById('progressBar');

const scenarioTitle = document.getElementById('scenarioTitle');
const scenarioText = document.getElementById('scenarioText');
const clusterBadge = document.getElementById('clusterBadge');
const hintBtn = document.getElementById('hintBtn');
const hintBox = document.getElementById('hintBox');
const optionsBox = document.getElementById('options');
const submitBtn = document.getElementById('submitBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');
const feedback = document.getElementById('feedback');

const clusterGrid = document.getElementById('clusterGrid');
const review = document.getElementById('review');
const toggleAll = document.getElementById('toggleAll');
const finalBox = document.getElementById('finalBox');
const finalScore = document.getElementById('finalScore');
const finalTotal = document.getElementById('finalTotal');

// -------- Init --------
render();

// -------- Handlers --------
hintBtn.addEventListener('click',()=>{
  const s = order[index];
  if(!s.hint){ hintBox.style.display='none'; return; }
  hintBox.textContent = s.hint;
  hintBox.style.display = (hintBox.style.display==='none')?'block':'none';
});

submitBtn.addEventListener('click',()=>{
  if(!choice) return;
  const s = order[index];
  const correct = choice === s.role;
  const partial = !correct && (s.alt||[]).includes(choice);
  const state = correct ? 'correct' : partial ? 'partial' : 'incorrect';
  const pts = correct ? 1 : partial ? .5 : 0;
  answers[s.id] = { pick: choice, score: pts, state };
  choice = null; // lock selection until changed
  render();
});

prevBtn.addEventListener('click',()=>{ index=Math.max(0,index-1); choice=null; render(); });
nextBtn.addEventListener('click',()=>{ index=Math.min(order.length-1,index+1); choice=null; render(); });
resetBtn.addEventListener('click',()=>{ order = shuffle([...SCENARIOS]); index=0; answers={}; choice=null; revealAll=false; render(); });

toggleAll.addEventListener('click',()=>{ revealAll=!revealAll; toggleAll.textContent = revealAll? 'Hide all explanations' : 'Show all explanations'; renderReview(); });

// -------- Render --------
function render(){
  const total = order.length;
  const answeredCount = Object.values(answers).filter(a=>a.state && a.pick!=null).length;
  const score = Object.values(answers).reduce((sum,a)=>sum+(a.score||0),0);
  qCount.textContent = `Questions: ${total}`;
  scoreBadge.textContent = `Score: ${score.toFixed(1)}`;
  progressText.textContent = `${answeredCount}/${total}`;
  progressBar.style.width = `${Math.round(answeredCount/total*100)}%`;

  const s = order[index];
  scenarioTitle.textContent = `Scenario ${index+1}`;
  scenarioText.textContent = `‚Äú${s.text}‚Äù`;
  clusterBadge.textContent = ROLES[s.role].cluster;
  hintBox.style.display='none';

  // Options
  optionsBox.innerHTML = '';
  ROLE_ORDER.forEach(rk=>{
    const opt = document.createElement('label');
    opt.className = 'opt';
    const input = document.createElement('input');
    input.type='radio'; input.name='role'; input.value=rk;
    input.checked = choice===rk;
    input.addEventListener('change',()=>{ choice = rk; });
    const box = document.createElement('div');
    const title = document.createElement('div');
    title.innerHTML = `<b>${ROLES[rk].name}</b> <span class="small">(${rk})</span>`;
    const sub = document.createElement('div');
    sub.className='small';
    sub.textContent = `${ROLES[rk].cluster} ‚Ä¢ ${ROLES[rk].blurb}`;
    box.appendChild(title); box.appendChild(sub);
    opt.appendChild(input); opt.appendChild(box);
    optionsBox.appendChild(opt);
  });

  // Buttons
  prevBtn.disabled = index===0;
  nextBtn.disabled = index===total-1;

  // Feedback
  feedback.innerHTML='';
  const ans = answers[s.id];
  if(ans){
    const panel = document.createElement('div');
    panel.className = 'result';
    const status = ans.state==='correct'? 'good' : ans.state==='partial' ? 'warn' : 'bad';
    panel.classList.add(status);
    const picked = ROLES[ans.pick].name;
    panel.innerHTML = `<div class="small"><b>${caps(ans.state)}</b> ${ans.state==='correct'?'+1':ans.state==='partial'?'+0.5':'+0'}</div>
      <div class="small">You picked <b>${picked}</b>. Correct role: <b>${ROLES[s.role].name}</b>.</div>`;
    const ul = document.createElement('ul'); ul.style.marginTop='8px';
    s.reasons.forEach(r=>{ const li=document.createElement('li'); li.textContent=r; ul.appendChild(li); });
    panel.appendChild(ul);
    const chips = document.createElement('div'); chips.className='chips';
    s.dims.forEach(d=>{ const c=document.createElement('span'); c.className='chip'; c.textContent=d; chips.appendChild(c); });
    panel.appendChild(chips);
    if(s.alt && s.alt.length){
      const p = document.createElement('p'); p.className='small'; p.style.marginTop='6px';
      p.textContent = 'Near‚Äëmisses: ' + s.alt.map(a=>ROLES[a].name).join(', ') + ' can resemble this scenario depending on context.';
      panel.appendChild(p);
    }
    feedback.appendChild(panel);
  }

  renderClusters();
  renderReview();

  // Final box
  const completed = answeredCount===total;
  finalBox.style.display = completed ? 'block' : 'none';
  if(completed){
    finalScore.textContent = score.toFixed(1);
    finalTotal.textContent = total;
  }
}

function renderClusters(){
  const totals = {Thought:0, People:0, Action:0};
  const corrects = {Thought:0, People:0, Action:0};
  order.forEach(s=>{ totals[ROLES[s.role].cluster]++; if(answers[s.id]?.state==='correct') corrects[ROLES[s.role].cluster]++; });
  clusterGrid.innerHTML='';
  ["Thought","People","Action"].forEach(cl=>{
    const box = document.createElement('div'); box.className='cluster-box';
    box.innerHTML = `<div class="small">${cl}</div><div style="font-size:22px;font-weight:700">${corrects[cl]}<span class="muted" style="font-size:16px">/${totals[cl]}</span></div><div class="small">Correct in this cluster</div>`;
    clusterGrid.appendChild(box);
  });
}

function renderReview(){
  review.innerHTML='';
  order.forEach((s,i)=>{
    const det = document.createElement('details');
    if(revealAll) det.setAttribute('open','open');
    const a = answers[s.id];
    const picked = a?.pick ? ROLES[a.pick].name : '‚Äî';
    const state = a?.state || 'pending';
    const chip = state==='correct'? '‚úÖ Correct' : state==='partial'? 'üü° Almost' : state==='incorrect'? '‚ùå Wrong' : '‚è≥ Pending';
    const sum = document.createElement('summary');
    sum.innerHTML = `<span class="small">Q${i+1}</span> <span>${chip}</span> <span class="small">&nbsp;‚Ä¢&nbsp; Correct: <b>${ROLES[s.role].name}</b> &nbsp;‚Ä¢&nbsp; You: <b>${picked}</b></span>`;
    det.appendChild(sum);

    const body = document.createElement('div'); body.style.marginTop='8px';
    const p = document.createElement('p'); p.className='small'; p.textContent = `‚Äú${s.text}‚Äù`; body.appendChild(p);
    const ul = document.createElement('ul'); s.reasons.forEach(r=>{ const li=document.createElement('li'); li.textContent=r; ul.appendChild(li); }); body.appendChild(ul);
    const chips = document.createElement('div'); chips.className='chips'; s.dims.forEach(d=>{ const c=document.createElement('span'); c.className='chip'; c.textContent=d; chips.appendChild(c); }); body.appendChild(chips);
    if(s.alt && s.alt.length){ const p2=document.createElement('p'); p2.className='small'; p2.textContent = 'Plausible alternatives: ' + s.alt.map(k=>ROLES[k].name).join(', '); body.appendChild(p2); }

    det.appendChild(body);
    review.appendChild(det);
  });
}

// -------- Utils --------
function shuffle(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}
function caps(s){ return s.charAt(0).toUpperCase()+s.slice(1); }
</script>
</body>
</html>
